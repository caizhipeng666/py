# 元编程

内容|description
---|---
属性|py中, 数据的属性 & 处理数据的方法 统称为 **属性**<br>方法只是可调用的属性
特性|在不改变类接口的前提下,<br>使用存取方法(get() & set())修改数据属性
动态属性|py中, obj.attr<br>py解释器会调用__getattr__和__setattr__计算属性
无效属性名|主要是涉及关键字<br>1. getattr(obj, "class")<br>2. keyword.iskeyword("xx")判断<br>3. py3的str的str.isidentifier()判断

类|description
---|---
\_\_new\_\_|是个类方法, 必须返回一个实例<br>这个实例会作为init的self参数
\_\_init\_\_|`def __init__(self, **kwargs)`<br>`self.__dict__.update(kwargs)`
\_\_dict\_\_|⚠️注意类的dict和实例的dict的区别
@property<br>(fget=None, fset=None, fdel=None, doc=None)<br>(想一下django的orm)|其实是一个类<br>`@property`<br>`def xxx(self):`<br><br>`@xxx.setter` # 可以对装饰的值 添加 设值方法<br>`@xxx.deleter`

### 属性描述符(ORM)
```python
class Field:
    pass

class IntField(Field):
    # 数据描述符
    def __init__(self, db_column, min_value=None, max_value=None):
        self._value = None
        self.min_value = min_value
        self.max_value = max_value
        self.db_column = db_column
        if min_value is not None:
            if not isinstance(min_value, numbers.Integral):
                raise ValueError("min_value must be int")
            elif min_value < 0:
                raise ValueError("min_value must be positive int")
        if max_value is not None:
            if not isinstance(max_value, numbers.Integral):
                raise ValueError("max_value must be int")
            elif max_value < 0:
                raise ValueError("max_value must be positive int")
        if min_value is not None and max_value is not None:
            if min_value > max_value:
                raise ValueError("min_value must be smaller than max_value")

    def __get__(self, instance, owner):
        return self._value

    def __set__(self, instance, value):
        if not isinstance(value, numbers.Integral):
            raise ValueError("int value need")
        if value < self.min_value or value > self.max_value:
            raise ValueError("value must between min_value and max_value")
        self._value = value
```